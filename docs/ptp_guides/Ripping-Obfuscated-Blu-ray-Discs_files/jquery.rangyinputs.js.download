/* Rangy Text Inputs, a cross-browser textarea and text input library plug-in for jQuery.
http://code.google.com/p/rangyinputs/
Copyright %%build:year%%, Tim Down Licensed under the MIT license. */
(function(m){function u(e,d){var b=typeof e[d];return"function"===b||!!("object"==b&&e[d])||"unknown"==b}function v(e,d,b){0>d&&(d+=e.value.length);typeof b==j&&(b=d);0>b&&(b+=e.value.length);return{start:d,end:b}}function n(){return"object"==typeof document.body&&document.body?document.body:document.getElementsByTagName("body")[0]}var j="undefined",g,f,p,k,q,r,s,t,l;m(document).ready(function(){function e(b,a){return function(){var c=this.jquery?this[0]:this,h=c.nodeName.toLowerCase();if(1==c.nodeType&& ("textarea"==h||"input"==h&&"text"==c.type))if(c=[c].concat(Array.prototype.slice.call(arguments)),c=b.apply(this,c),!a)return c;if(a)return this}}var d=document.createElement("textarea");n().appendChild(d);if(typeof d.selectionStart!=j&&typeof d.selectionEnd!=j)g=function(b){var a=b.selectionStart,c=b.selectionEnd;return{start:a,end:c,length:c-a,text:b.value.slice(a,c)}},f=function(b,a,c){a=v(b,a,c);b.selectionStart=a.start;b.selectionEnd=a.end},l=function(b,a){a?b.selectionEnd=b.selectionStart: b.selectionStart=b.selectionEnd};else if(u(d,"createTextRange")&&"object"==typeof document.selection&&document.selection&&u(document.selection,"createRange"))g=function(b){var a=0,c=0,h,e,d;if((d=document.selection.createRange())&&d.parentElement()==b)e=b.value.length,h=b.value.replace(/\r\n/g,"\n"),c=b.createTextRange(),c.moveToBookmark(d.getBookmark()),d=b.createTextRange(),d.collapse(!1),-1<c.compareEndPoints("StartToEnd",d)?a=c=e:(a=-c.moveStart("character",-e),a+=h.slice(0,a).split("\n").length- 1,-1<c.compareEndPoints("EndToEnd",d)?c=e:(c=-c.moveEnd("character",-e),c+=h.slice(0,c).split("\n").length-1));return{start:a,end:c,length:c-a,text:b.value.slice(a,c)}},f=function(b,a,c){a=v(b,a,c);c=b.createTextRange();var d=a.start-(b.value.slice(0,a.start).split("\r\n").length-1);c.collapse(!0);a.start==a.end?c.move("character",d):(c.moveEnd("character",a.end-(b.value.slice(0,a.end).split("\r\n").length-1)),c.moveStart("character",d));c.select()},l=function(b,a){var c=document.selection.createRange(); c.collapse(a);c.select()};else{n().removeChild(d);window.console&&window.console.log&&window.console.log("RangyInputs not supported in your browser. Reason: No means of finding text input caret position");return}n().removeChild(d);k=function(b,a,c,d){var e;a!=c&&(e=b.value,b.value=e.slice(0,a)+e.slice(c));d&&f(b,a,a)};p=function(b){var a=g(b);k(b,a.start,a.end,!0)};t=function(b){var a=g(b),c;a.start!=a.end&&(c=b.value,b.value=c.slice(0,a.start)+c.slice(a.end));f(b,a.start,a.start);return a.text}; q=function(b,a,c,d){var e=b.value;b.value=e.slice(0,c)+a+e.slice(c);d&&(a=c+a.length,f(b,a,a))};r=function(b,a){var c=g(b),d=b.value;b.value=d.slice(0,c.start)+a+d.slice(c.end);c=c.start+a.length;f(b,c,c)};s=function(b,a,c){typeof c==j&&(c=a);var d=g(b),e=b.value;b.value=e.slice(0,d.start)+a+d.text+c+e.slice(d.end);a=d.start+a.length;f(b,a,a+d.length)};m.fn.extend({getSelection:e(g,!1),setSelection:e(f,!0),collapseSelection:e(l,!0),deleteSelectedText:e(p,!0),deleteText:e(k,!0),extractSelectedText:e(t, !1),insertText:e(q,!0),replaceSelectedText:e(r,!0),surroundSelectedText:e(s,!0)});m.fn.rangyInputs={getSelection:g,setSelection:f,collapseSelection:l,deleteSelectedText:p,deleteText:k,extractSelectedText:t,insertText:q,replaceSelectedText:r,surroundSelectedText:s}})})(jQuery);